{
  "info": {
    "name": "FriendSync API - Production Ready with Auto-Cleanup",
    "description": "Complete API collection with automated tests and cleanup. Automatically deletes test users after running.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://project03-friendsync-backend-8c893d18fe37.herokuapp.com",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "friendId",
      "value": "",
      "type": "string"
    },
    {
      "key": "eventId",
      "value": "",
      "type": "string"
    },
    {
      "key": "rsvpId",
      "value": "",
      "type": "string"
    },
    {
      "key": "friendshipId",
      "value": "",
      "type": "string"
    },
    {
      "key": "userPrefsId",
      "value": "",
      "type": "string"
    },
    {
      "key": "createdUserIds",
      "value": "[]",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "User Routes",
      "item": [
        {
          "name": "Create User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201, 200, or 400 (user exists)', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201, 400]);",
                  "});",
                  "",
                  "if (pm.response.code === 400) {",
                  "    console.log('Test user already exists - this is expected');",
                  "} else {",
                  "    pm.test('Response is valid JSON', function () {",
                  "        pm.response.to.be.json;",
                  "    });",
                  "    ",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var userId = jsonData.id || jsonData.userId || jsonData.uid;",
                  "        if (userId) {",
                  "            pm.collectionVariables.set('userId', userId);",
                  "            console.log('Saved userId:', userId);",
                  "            ",
                  "            // Track created user IDs for cleanup",
                  "            var createdIds = JSON.parse(pm.collectionVariables.get('createdUserIds') || '[]');",
                  "            if (!createdIds.includes(userId)) {",
                  "                createdIds.push(userId);",
                  "                pm.collectionVariables.set('createdUserIds', JSON.stringify(createdIds));",
                  "                console.log('Tracking user for cleanup:', userId);",
                  "            }",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"postman_test_user_{{$timestamp}}\",\n  \"password\": \"test123\",\n  \"email\": \"postman_test_{{$timestamp}}@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        },
        {
          "name": "Create Friend User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201, 200, or 400', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201, 400]);",
                  "});",
                  "",
                  "if (pm.response.code !== 400) {",
                  "    pm.test('Response is valid JSON', function () {",
                  "        pm.response.to.be.json;",
                  "    });",
                  "    ",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var friendId = jsonData.id || jsonData.userId || jsonData.uid;",
                  "        if (friendId) {",
                  "            pm.collectionVariables.set('friendId', friendId);",
                  "            console.log('Saved friendId:', friendId);",
                  "            ",
                  "            // Track created user IDs for cleanup",
                  "            var createdIds = JSON.parse(pm.collectionVariables.get('createdUserIds') || '[]');",
                  "            if (!createdIds.includes(friendId)) {",
                  "                createdIds.push(friendId);",
                  "                pm.collectionVariables.set('createdUserIds', JSON.stringify(createdIds));",
                  "                console.log('Tracking friend for cleanup:', friendId);",
                  "            }",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"postman_friend_{{$timestamp}}\",\n  \"password\": \"test123\",\n  \"email\": \"postman_friend_{{$timestamp}}@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        },
        {
          "name": "Get User by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "{{userId}}"]
            }
          }
        },
        {
          "name": "Get All Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        }
      ]
    },
    {
      "name": "Friend Routes",
      "item": [
        {
          "name": "Send Friend Request",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var friendshipId = jsonData.id || jsonData.friendshipId;",
                  "        if (friendshipId) {",
                  "            pm.collectionVariables.set('friendshipId', friendshipId);",
                  "            console.log('Saved friendshipId:', friendshipId);",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{userId}}\",\n  \"friendId\": \"{{friendId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/friends/request",
              "host": ["{{baseUrl}}"],
              "path": ["api", "friends", "request"]
            }
          }
        },
        {
          "name": "Accept Friend Request",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/friends/{{friendshipId}}/accept",
              "host": ["{{baseUrl}}"],
              "path": ["api", "friends", "{{friendshipId}}", "accept"]
            }
          }
        },
        {
          "name": "Get User's Friends",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/friends/user/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "friends", "user", "{{userId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Event Routes",
      "item": [
        {
          "name": "Create Event",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var eventId = jsonData.id || jsonData.eventId;",
                  "        if (eventId) {",
                  "            pm.collectionVariables.set('eventId', eventId);",
                  "            console.log('Saved eventId:', eventId);",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"eventTitle\": \"Postman Test Event\",\n  \"description\": \"Auto-cleanup test\",\n  \"userId\": \"{{userId}}\",\n  \"isEvent\": true,\n  \"startTime\": \"2024-12-15T10:00:00\",\n  \"endTime\": \"2024-12-15T11:00:00\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/events",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events"]
            }
          }
        },
        {
          "name": "Get Event by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/events/{{eventId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "events", "{{eventId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "RSVP Routes",
      "item": [
        {
          "name": "Send Single Invitation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var rsvpId = jsonData.id || jsonData.rsvpId;",
                  "        if (rsvpId) {",
                  "            pm.collectionVariables.set('rsvpId', rsvpId);",
                  "            console.log('Saved rsvpId:', rsvpId);",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"eventId\": \"{{eventId}}\",\n  \"userId\": \"{{friendId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/rsvps/invite",
              "host": ["{{baseUrl}}"],
              "path": ["api", "rsvps", "invite"]
            }
          }
        },
        {
          "name": "Get RSVPs for Event",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/rsvps/event/{{eventId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "rsvps", "event", "{{eventId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "User Preferences Routes",
      "item": [
        {
          "name": "Create User Preferences",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    try {",
                  "        var jsonData = pm.response.json();",
                  "        var userPrefsId = jsonData.id || jsonData.prefsId;",
                  "        if (userPrefsId) {",
                  "            pm.collectionVariables.set('userPrefsId', userPrefsId);",
                  "            console.log('Saved userPrefsId:', userPrefsId);",
                  "        }",
                  "    } catch(e) {",
                  "        console.log('Could not parse response:', e);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{userId}}\",\n  \"theme\": \"dark\",\n  \"notifications\": true,\n  \"colorScheme\": \"blue\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/user-prefs",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user-prefs"]
            }
          }
        },
        {
          "name": "Get Preferences by User ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is valid JSON', function () {",
                  "    pm.response.to.be.json;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/user-prefs/user/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "user-prefs", "user", "{{userId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "ðŸ§¹ CLEANUP - Run at End",
      "item": [
        {
          "name": "Delete Friend User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Friend user deleted or not found', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    console.log('âœ… Deleted friend user:', pm.collectionVariables.get('friendId'));",
                  "} else {",
                  "    console.log('â„¹ï¸ Friend user not found (may have been deleted already)');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/{{friendId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "{{friendId}}"]
            }
          }
        },
        {
          "name": "Delete Main Test User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Main user deleted or not found', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    console.log('âœ… Deleted main user:', pm.collectionVariables.get('userId'));",
                  "} else {",
                  "    console.log('â„¹ï¸ Main user not found (may have been deleted already)');",
                  "}",
                  "",
                  "// Clear all variables after cleanup",
                  "pm.collectionVariables.set('userId', '');",
                  "pm.collectionVariables.set('friendId', '');",
                  "pm.collectionVariables.set('eventId', '');",
                  "pm.collectionVariables.set('rsvpId', '');",
                  "pm.collectionVariables.set('friendshipId', '');",
                  "pm.collectionVariables.set('userPrefsId', '');",
                  "pm.collectionVariables.set('createdUserIds', '[]');",
                  "",
                  "console.log('âœ¨ Cleanup complete! All test users deleted and variables cleared.');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users", "{{userId}}"]
            }
          }
        },
        {
          "name": "Verify Cleanup - Get All Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "// Check if test users still exist",
                  "var jsonData = pm.response.json();",
                  "var testUsersRemaining = jsonData.filter(user => ",
                  "    (user.username && user.username.includes('postman_test')) ||",
                  "    (user.username && user.username.includes('postman_friend'))",
                  ");",
                  "",
                  "if (testUsersRemaining.length === 0) {",
                  "    console.log('âœ… All test users cleaned up successfully!');",
                  "} else {",
                  "    console.log('âš ï¸ Warning: ' + testUsersRemaining.length + ' test users still remain');",
                  "    testUsersRemaining.forEach(user => {",
                  "        console.log('  - ' + user.username + ' (ID: ' + user.id + ')');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/users",
              "host": ["{{baseUrl}}"],
              "path": ["api", "users"]
            }
          }
        }
      ]
    }
  ]
}